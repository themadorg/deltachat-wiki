---
title: سینتکس پیکربندی
category: مرجع
---

# سینتکس فایل‌های پیکربندی

**توجه:** این فایل یک سند فنی است که نحوه تجزیه (parsing) فایل‌های پیکربندی توسط Madmail را توصیف می‌کند.

پیکربندی شامل «دستورالعمل‌هایی» (directives) است که با خط جدید از هم جدا شده‌اند. هر دستورالعمل می‌تواند صفر یا چند آرگومان داشته باشد.

```hcl
directive0
directive1 arg0 arg1
```

هر خطی که با `#` شروع شود نادیده گرفته می‌شود. خطوط خالی نیز نادیده گرفته می‌شوند.

## استفاده از کوتیشن (Quoting)

رشته‌هایی که شامل فضای خالی (whitespace) هستند باید در کوتیشن دوتایی (`"`) قرار گیرند تا اطمینان حاصل شود که به‌عنوان یک آرگومان واحد تفسیر می‌شوند.

```hcl
directive0 two arguments
directive1 "one argument"
```

رشته‌ای که در کوتیشن قرار دارد می‌تواند شامل خط جدید باشد و به‌عنوان جداکننده دستورالعمل تفسیر نخواهد شد.

```hcl
directive0 "one long big
argument for directive0"
```

فقط و فقط کوتیشن را می‌توان در داخل لیترال‌ها با یک بک‌اسلش فرار داد: `\"`

از بک‌اسلش (`\`) می‌توان در انتهای خط برای ادامه دستورالعمل در خط بعدی استفاده کرد.

## بلوک‌ها (Blocks)

یک دستورالعمل می‌تواند چندین زیردستورالعمل داشته باشد. آن‌ها در یک بلوک محصور در `{}` به شکل زیر نوشته می‌شوند:

```hcl
directive0 arg0 arg1 {
    subdirective0 arg0 arg1
    subdirective1 etc
}
```

زیردستورالعمل‌ها خود نیز می‌توانند بلوک داشته باشند.

```hcl
directive0 {
    subdirective0 {
        subdirective2 {
            a
            b
            c
        }
    }
    subdirective1 { }
}
```

سطح تودرتویی محدود است، اما با یک پیکربندی صحیح هرگز به این محدودیت برخورد نخواهید کرد.

در بیشتر موارد، یک بلوک خالی معادل نبود بلوک است:
```hcl
directive { }
directive2 # مشابه حالت بالا
```

## متغیرهای محیطی (Environment variables)

متغیرهای محیطی را می‌توان در پیکربندی با استفاده از سینتکس `$VARIABLE` یا `{env:VARIABLENAME}` ارجاع داد.

متغیرهایی که وجود ندارند به رشته‌های خالی تبدیل می‌شوند و از لیست آرگومان‌ها حذف نمی‌شوند. در مثال زیر، `directive0` مستقل از اینکه `VAR` تعریف شده باشد یا نه، یک آرگومان خواهد داشت.

```hcl
directive0 {env:VAR}
```

تجزیه‌گر (Parser) بخشنده است و نگهدارنده متغیر ناقص (مثلاً `env:VAR{`) را همان‌طور که هست رها می‌کند. متغیرها در داخل کوتیشن‌ها نیز جایگزین می‌شوند.

## تکه‌کدها و ورودی‌ها (Snippets & imports)

می‌توانید بلوک‌های پیکربندی را با تعریف آن‌ها به‌صورت «تکه‌کد» (snippets) مجدداً استفاده کنید. تکه‌کد فقط یک دستورالعمل همراه با یک بلوک است که در سطح بالا (نه در داخل بلوک‌های دیگر) تعریف شده و نام آن در پرانتز قرار گرفته است.

```hcl
(snippetname) {
    a
    b
    c
}
```

سپس می‌توان با استفاده از متا-دستورالعمل `import` به این تکه‌کد ارجاع داد.

```hcl
unrelated0
unrelated1
import snippetname
```

مثال بالا به پیکربندی زیر تبدیل خواهد شد:

```hcl
unrelated0
unrelated1
a
b
c
```

دستور `import` همچنین می‌تواند برای وارد کردن محتوا از فایل‌های دیگر استفاده شود. این کار دقیقاً مشابه تکه‌کدها عمل می‌کند، با این تفاوت که باید مسیر فایل استفاده شود. مسیر می‌تواند نسبت به محل فایل پیکربندی فعلی یا مطلق باشد. اگر هم تکه‌کد و هم فایلی با همان نام وجود داشته باشد، از تکه‌کد استفاده می‌شود.

```hcl
# /etc/maddy/tls.conf
tls long_path_to_certificate long_path_to_private_key

# /etc/maddy/maddy.conf
smtp tcp://0.0.0.0:25 {
    import tls.conf
}
```

```hcl
# به شکل زیر باز می‌شود:
smtp tcp://0.0.0.0:25 {
    tls long_path_to_certificate long_path_to_private_key
}
```

فایل وارد شده (imported) می‌تواند تکه‌کدهای جدیدی را معرفی کند که در هر فایل پیکربندی در حال پردازش قابل ارجاع باشند.

## مقادیر بازه زمانی (Duration values)

دستورالعمل‌هایی که بازه زمانی می‌پذیرند از فرمت زیر استفاده می‌کنند: دنباله‌ای از اعداد دهدهی با یک جزء اعشاری اختیاری و پسوند واحد (صفر را می‌توان بدون پسوند مشخص کرد). اگر چندین مقدار مشخص شود، با هم جمع می‌شوند.

پسوندهای واحد معتبر: `h` (ساعت)، `m` (دقیقه)، `s` (ثانیه)، `ms` (میلی‌ثانیه). پیاده‌سازی همچنین `us` و `ns` را برای میکروثانیه و نانوثانیه می‌پذیرد، اما این مقادیر در عمل کاربردی ندارند.

مثال‌ها:
```hcl
1h
1h 5m
1h5m
0
```

## مقادیر اندازه داده (Data size values)

مشابه مقادیر بازه زمانی، اما اجزای اعشاری مجاز نیستند و پسوندها متفاوت هستند.

پسوندهای واحد معتبر: `G` (گیبی‌بایت، ۱۰۲۴ به توان ۳ بایت)، `M` (می‌بی‌بایت، ۱۰۲۴ به توان ۲ بایت)، `K` (کی‌بی‌بایت، ۱۰۲۴ بایت)، `B` یا `b` (بایت).

مثال‌ها:
```hcl
32M
3M 5K
5b
```

همچنین توجه داشته باشید که برخلاف مقادیر بازه زمانی، مورد زیر معتبر نیست:
```hcl
32M5K
```

## تعاریف آدرس

پیکربندی Madmail از سینتکسی شبیه URL برای مشخص کردن آدرس‌های شبکه استفاده می‌کند.

- `unix://file_path` – سوکت دامنه یونیکس. مسیرهای نسبی نسبت به دایرکتوری زمان اجرا (`/run/maddy`) سنجیده می‌شوند.
- `tcp://ADDRESS:PORT` – سوکت TCP/IP.
- `tls://ADDRESS:PORT` – سوکت TCP/IP با استفاده از TLS.

## ماژول Dummy

ماژول بی‌اثر (No-op). نیازی به پیکربندی صریح ندارد و می‌توان با نام "dummy" به آن ارجاع داد. این ماژول می‌تواند به‌عنوان یک هدف تحویل یا ارائه‌دهنده احراز هویت عمل کند. در حالت دوم، هر اطلاعات شناسایی را می‌پذیرد و به هر کلاینتی اجازه می‌دهد با هر نام کاربری و رمز عبوری احراز هویت شود (با احتیاط استفاده کنید!).
