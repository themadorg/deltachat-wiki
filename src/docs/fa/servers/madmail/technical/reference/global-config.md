---
title: پیکربندی سراسری
category: مرجع
---

# دستورالعمل‌های پیکربندی سراسری

این دستورالعمل‌ها را می‌توان خارج از هر بلوک پیکربندی مشخص کرد و بر تمام ماژول‌ها اعمال می‌شوند.

برخی از دستورالعمل‌ها را می‌توان به ازای هر ماژول لغو کرد (مانند hostname).

### `state_dir [path]`
پیش‌فرض: `/var/lib/maddy`

مسیر دایرکتوری وضعیت (state). این دایرکتوری برای ذخیره تمام داده‌های دائمی استفاده می‌شود و باید قابل نوشتن (writable) باشد.

---

### `runtime_dir [path]`
پیش‌فرض: `/run/maddy`

مسیر دایرکتوری زمان اجرا. برای سوکت‌های یونیکس و سایر اشیاء موقت استفاده می‌شود. باید قابل نوشتن باشد.

---

### `hostname [domain]`
پیش‌فرض: مشخص نشده است

نام میزبان اینترنتی این سرور ایمیل. معمولاً از FQDN استفاده می‌شود. توصیه می‌شود اطمینان حاصل کنید که دامنه مشخص شده در اینجا به IP عمومی سرور اشاره می‌کند.

---

### `auth_map [module-reference]`
پیش‌فرض: `identity`

از جدول مشخص شده برای ترجمه نام‌های کاربری SASL قبل از ارسال آن‌ها به ارائه‌دهنده احراز هویت استفاده می‌کند.

قبل از جستجوی نام کاربری، با استفاده از تابعی که توسط `auth_map_normalize` تعریف شده، نرمال‌سازی می‌شود.

توجه داشته باشید که `auth_map` بر نام حساب ذخیره‌سازی استفاده شده تأثیری نمی‌گذارد. احتمالاً برای مدیریت این موضوع باید از `storage_map` در بلوک پیکربندی IMAP نیز استفاده کنید.

این دستورالعمل زمانی مفید است که ارائه‌دهنده احراز هویت استفاده شده از ایمیل به‌عنوان نام کاربری پشتیبانی نمی‌کند، اما شما همچنان می‌خواهید کاربران صندوق‌های پستی مجزایی روی دامنه‌های مختلف داشته باشند. در این حالت، از آن با جدول `email_localpart` استفاده کنید:

```hcl
auth_map email_localpart
```

با این پیکربندی، `user@example.org` و `user@example.com` هنگام احراز هویت از اطلاعات شناسایی `user` استفاده می‌کنند، اما به ترتیب به صندوق‌های پستی `user@example.org` و `user@example.com` دسترسی خواهند داشت. اگر می‌خواهید `user` را نیز به‌عنوان نام کاربری بپذیرید، از `auth_map email_localpart_optional` استفاده کنید.

اگر می‌خواهید `user@example.org` و `user@example.com` صندوق پستی یکسانی داشته باشند، `storage_map` را نیز در بلوک پیکربندی IMAP روی `email_localpart` تنظیم کنید (یا `email_localpart_optional` اگر می‌خواهید فقط "user" را نیز بپذیرید):

```hcl
storage_map email_localpart
```

در این صورت باید حساب‌های ذخیره‌سازی را بدون بخش دامنه در نام ایجاد کنید:

```bash
maddy imap-acct create user # به جای user@example.org
```

---

### `auth_map_normalize [function]`
پیش‌فرض: `auto`

تابع نرمال‌سازی برای اعمال روی نام‌های کاربری SASL قبل از نقشه‌برداری (mapping) آن‌ها به حساب‌های ذخیره‌سازی.

گزینه‌های موجود:

- `auto` – برای ایمیل‌های معتبر `precis_casefold_email` و در غیر این صورت `precis_casefold`.
- `precis_casefold_email` – پروفایل PRECIS UsernameCaseMapped + فرم U-labels برای دامنه.
- `precis_casefold` – پروفایل PRECIS UsernameCaseMapped برای کل رشته.
- `precis_email` – پروفایل PRECIS UsernameCasePreserved + فرم U-labels برای دامنه.
- `precis` – پروفایل PRECIS UsernameCasePreserved برای کل رشته.
- `casefold` – تبدیل به حروف کوچک.
- `noop` – هیچ کاری انجام نمی‌دهد.

---

### `autogenerated_msg_domain [domain]`
پیش‌فرض: مشخص نشده است

دامنه‌ای که در فیلد From برای پیام‌های خودکار تولید شده (مانند اعلان‌های وضعیت تحویل یا DSN) استفاده می‌شود.

---

### `tls file [cert-file] [pkey-file] | [module-reference] | off`
پیش‌فرض: مشخص نشده است

گواهی TLS پیش‌فرض برای تمام نقاط انتهایی (endpoints).

باید در بلوک‌های پیکربندی تمام ماژول‌های نقطه انتهایی یا به‌عنوان دستورالعمل سراسری وجود داشته باشد.

همچنین می‌توانید سایر گزینه‌های پیکربندی مانند مجموعه‌های رمز (cipher suites) و نسخه TLS را مشخص کنید. Madmail به‌طور پیش‌فرض از مجموعه‌های رمز و نسخه‌های TLS معقول استفاده می‌کند، بنابراین معمولاً نیازی به نگرانی نیست.

---

### `tls_client`
پیش‌فرض: مشخص نشده است

این یک بلوک اختیاری است که گزینه‌های مختلف مربوط به TLS را برای استفاده هنگام برقراری اتصالات خروجی مشخص می‌کند. Madmail به‌طور پیش‌فرض از تنظیمات امن استفاده می‌کند.

---

### `log [targets...] | off`
پیش‌فرض: `stderr`

لاگ را در یک یا چند «هدف» (targets) می‌نویسد.

هدف می‌تواند یکی از موارد زیر باشد:

- `stderr` – نوشتن لاگ‌ها در خروجی خطای استاندارد (stderr).
- `stderr_ts` – نوشتن لاگ‌ها در stderr همراه با برچسب زمان (timestamps).
- `syslog` – ارسال لاگ‌ها به دیمون syslog محلی.
- *مسیر فایل* – نوشتن (افزودن) لاگ‌ها در یک فایل.

مثال:

```hcl
log syslog /var/log/maddy.log
```

**توجه:** Madmail چرخش فایل‌های لاگ (log rotation) را انجام نمی‌دهد؛ این وظیفه دیمون logrotate است. برای اینکه Madmail فایل‌های لاگ را دوباره باز کند، سیگنال SIGUSR1 را به پردازش آن ارسال کنید.

---

### `debug [boolean]`
پیش‌فرض: `no`

فعال کردن ثبت لاگ‌های پرجزئیات (verbose) برای تمام ماژول‌ها. شما به این مورد نیاز ندارید مگر اینکه بخواهید یک باگ را گزارش کنید.
 Victorian
