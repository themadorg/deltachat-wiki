---
title: مقدمه ماژول‌ها
category: مرجع
---

# مقدمه ماژول‌ها

Madmail از اجزای کوچک بسیاری به نام «ماژول» ساخته شده است. هر ماژول یک وظیفه مشخص و دقیق را انجام می‌دهد. ماژول‌ها می‌توانند به روش‌های دلخواه به یکدیگر متصل شوند تا عملکرد مورد نظر حاصل شود. فایل پیکربندی پیش‌فرض، مجموعه‌ای از ماژول‌ها را تعریف می‌کند که با هم یک پشته سرور ایمیل معمولی را پیاده‌سازی می‌کنند.

برای مشخص کردن ماژولی که باید توسط ماژول دیگری استفاده شود، به دنبال دستورالعمل‌هایی با آرگومان «module reference» بگردید. سپس نام ماژول را به‌عنوان آرگومان برای آن قرار دهید. در صورتی که ماژول ارجاع داده شده نیاز داشته باشد، می‌توانید آرگومان‌های اضافی را بعد از نام ماژول وارد کنید. همچنین می‌توانید یک بلوک پیکربندی با دستورالعمل‌های اضافی برای تنظیمات ماژول قرار دهید.

در اینجا چند مثال آورده شده است:

```hcl
smtp ... {
    # تحویل پیام‌ها به ماژول 'dummy' با پیکربندی پیش‌فرض.
    deliver_to dummy

    # تحویل پیام‌ها به ماژول 'target.smtp' با 
    # آرگومان 'tcp://127.0.0.1:1125' به‌عنوان پیکربندی.
    deliver_to smtp tcp://127.0.0.1:1125

    # تحویل پیام‌ها به ماژول 'queue' با پیکربندی مشخص شده.
    deliver_to queue {
        target ...
        max_tries 10
    }
}
```

علاوه بر این، پیکربندی ماژول می‌تواند در یک بلوک نام‌گذاری شده جداگانه در سطح بالا (top-level) قرار گیرد و در هر کجا که نیاز بود با نامش به آن ارجاع داده شود.

مثال:
```hcl
storage.imapsql local_mailboxes {
    driver sqlite3
    dsn all.db
}

smtp ... {
    deliver_to &local_mailboxes
}
```

توصیه می‌شود از این سینتکس برای ماژول‌هایی که مقداردهی اولیه آن‌ها «سنگین» است، مانند بک‌اِندهای ذخیره‌سازی و ارائه‌دهندگان احراز هویت، استفاده کنید.

برای تعریف بلوک پیکربندی در سطح بالا، سینتکس به شرح زیر است:
```hcl
namespace.module_name config_block_name... {
    module_configuration
}
```
اگر `config_block_name` حذف شود، نام آن همان `module_name` خواهد بود. می‌توان چندین نام را مشخص کرد. تمام نام‌ها باید یکتا باشند.

به پیشوند `.storage` توجه کنید. این نام واقعی ماژول است و شامل «فضای نام» (namespace) می‌شود. برای کوتاه‌تر شدن نام‌ها، هنگام ارجاع به ماژول در جایی که استفاده می‌شود، می‌توان پیشوند را حذف کرد زیرا معمولاً قابل حدس زدن است (مثلاً قرار دادن ارجاع ماژول در `{}`likely` means you want something with `check.` prefix).

آرگومان‌های معمول ماژول را نمی‌توان هنگام استفاده از این سینتکس مشخص کرد، اما ماژول‌ها معمولاً دستورالعمل‌های صریحی برای تعیین مقادیر مورد نیاز ارائه می‌دهند. به عنوان مثال `sql sqlite3 all.db` معادل است با:
```hcl
storage.imapsql {
    driver sqlite3
    dsn all.db
}
```
