---
title: پیکربندی TLS
category: مرجع
---

# پیکربندی TLS

## سمت سرور

گواهی‌های TLS توسط ماژول‌هایی به نام «لودر گواهی» (certificate loaders) دریافت می‌شوند. آرگومان‌های دستورالعمل `tls` نام لودر مورد استفاده و آرگومان‌های آن را مشخص می‌کنند.

```hcl
tls file cert.pem key.pem {
    protocols tls1.2 tls1.3
    curves X25519
    ciphers ...
}

tls {
    loader file cert.pem key.pem {
        # گزینه‌های لودر در اینجا قرار می‌گیرند.
    }
    protocols tls1.2 tls1.3
    curves X25519
    ciphers ...
}
```

### لودرهای گواهی موجود

- `file` – جفت آرگومان‌هایی را می‌پذیرد که ابتدا گواهی و سپس کلید را مشخص می‌کنند. به عنوان مثال: `tls file certA.pem keyA.pem certB.pem keyB.pem`. اگر چندین گواهی لیست شود، از SNI استفاده خواهد شد.
- `acme` – به‌طور خودکار با استفاده از پروتکل ACME (مانند Let's Encrypt) گواهی دریافت می‌کند.
- `off` – به‌طور صریح TLS را برای نقطه(های) انتهایی غیرفعال می‌کند.

## پیکربندی پیشرفته TLS

**توجه:** Madmail از تنظیمات پیش‌فرض امن استفاده می‌کند و دست‌دادن (handshake) TLS در برابر حملات کاهش سطح (downgrade attacks) فعال مقاوم است. در بیشتر موارد نیازی به تغییر چیزی نیست.

### `protocols [min-version] [max-version]`
پیش‌فرض: `tls1.0 tls1.3`

حداقل/حداکثر نسخه پذیرفته شده TLS. اگر فقط یک مقدار مشخص شود، آن تنها نسخه قابل استفاده خواهد بود. مقادیر معتبر: `tls1.0`, `tls1.1`, `tls1.2`, `tls1.3`.

### `ciphers [ciphers...]`
پیش‌فرض: مجموعه‌ای از رمزهای (ciphers) امن تعریف شده در زبان Go.

لیستی از مجموعه‌های رمز پشتیبانی شده، به ترتیب اولویت. در TLS 1.3 استفاده نمی‌شود.

### `curves [curves...]`
پیش‌فرض: منحنی‌های تعریف شده در زبان Go.

منحنی‌های بیضوی مورد استفاده در دست‌دادن ECDHE. مقادیر معتبر: `p256`, `p384`, `p521`, `X25519`.

## پیکربندی کلاینت

دستورالعمل `tls_client` اجازه می‌دهد تا رفتار کلاینت TLS برای اتصالات خروجی سفارشی‌سازی شود.

```hcl
tls_client {
    protocols tls1.2 tls1.3
    ciphers ...
    curves X25519
    root_ca /etc/ssl/cert.pem

    cert /etc/ssl/private/madmail-client.pem
    key /etc/ssl/private/madmail-client.pem
}
```

### `protocols [min-version] [max-version]`
پیش‌فرض: `tls1.0 tls1.3`

### `root_ca [paths...]`
پیش‌فرض: مخزن CA سیستم.

لیستی از فایل‌ها با گواهی‌های CA کدگذاری شده به فرم PEM برای استفاده هنگام تأیید گواهی‌های سرور.

### `cert [path]` و `key [path]`
پیش‌فرض: مشخص نشده است.

زمانی که سرور درخواست گواهی کلاینت می‌کند، گواهی مشخص شده را ارائه می‌دهد.
