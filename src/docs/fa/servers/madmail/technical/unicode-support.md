---
title: پشتیبانی از یونیکد
description: اطلاعات درباره پشتیبانی تراز اول Madmail از یونیکد، ایمیل‌های بین‌المللی شده و اجبار پروفایل PRECIS.
category: فنی
---

# پشتیبانی از یونیکد

maddy در تمام اجزای خود (ماژول‌ها) پشتیبانی تراز اولی از یونیکد دارد. شما برای کار با دامنه‌های بین‌المللی، نام صندوق‌های پستی یا هدرهای پیام غیر ASCII نیاز به انجام هیچ اقدام خاصی ندارید.

در داخل سیستم، تمام فیلد‌های متنی در maddy به‌صورت UTF-8 نمایش داده می‌شوند و با استفاده از عملیات‌های آگاه از یونیکد برای مقایسه، تبدیل حروف (case-folding) و غیره مدیریت می‌شوند.

## داده‌های غیر ASCII در هدرها و بدنه پیام

پیاده‌سازی SMTP در maddy نسبت به کدگذاری‌های استفاده شده در هدرهای MIME یا فیلد charset در `Content-Type text/*` حساسیتی ندارد.

با این حال، پیاده‌سازی ذخیره‌سازی محلی IMAP نیاز به انجام عملیات‌های خاصی روی محتوای هدرها دارد. این موضوع بیشتر مربوط به قابلیت SEARCH است. برای اینکه جستجوی IMAP به‌درستی کار کند، بدنه و هدرهای پیام باید از یکی از کدگذاری‌های زیر استفاده کنند:

- ASCII
- UTF-8
- ISO-8859-1, 2, 3, 4, 9, 10, 13, 14, 15 or 16
- Windows-1250, 1251 or 1252 (موسوم به Code Page 1250 و غیره)
- KOI8-R
- ~~HZGB2312~~, GB18030
- GBK (موسوم به Code Page 936)
- Shift JIS (موسوم به Code Page 932 یا Windows-31J)
- Big-5 (موسوم به Code Page 950)
- EUC-JP
- ISO-2022-JP

*پشتیبانی از HZGB2312 در حال حاضر به دلیل باگ‌هایی با پیامدهای امنیتی غیرفعال است.*

اگر صندوق پستی پیامی با کدگذاری‌ غیر از موارد لیست شده در اینجا داشته باشد، آن پیام در نتایج جستجو برای هیچ درخواستی ظاهر نخواهد شد.

رفتار مربوط به مدیریت کدگذاری‌های غیر یونیکد پایدار تلقی نمی‌شود و ممکن است بین نسخه‌ها تغییر کند (از جمله حذف کدگذاری‌های پشتیبانی شده). اگر نیاز دارید که سیستم شما به‌درستی کار کند، شروع به استفاده از UTF-8 کنید.

## فایل‌های پیکربندی

فرض بر این است که فایل‌های پیکربندی maddy با کدگذاری UTF-8 هستند. استفاده از هر کدگذاری دیگری باعث خرابی سیستم می‌شود، پس این کار را انجام ندهید.

نام دامنه‌ها (مثلاً در دستورالعمل hostname یا قوانین خط لوله) می‌توانند با فرم ACE (موسوم به Punycode) نمایش داده شوند. آن‌ها در داخل سیستم به فرم یونیکد تبدیل خواهند شد.

## اطلاعات شناسایی محلی

بک‌اِند ذخیره‌سازی 'sql' و ارائه‌دهنده احراز هویت، تعدادی محدودیت اضافی بر نام حساب‌های کاربری مورد استفاده اعمال می‌کنند.

پروفایل PRECIS UsernameCaseMapped برای آدرس‌های ایمیل محلی اجبار می‌شود. این پروفایل استفاده از کاراکترهای کنترلی و Bidi (دوجهته) را محدود می‌کند تا اطمینان حاصل شود که مقدار استفاده شده می‌تواند به‌طور ثابتی در محیط‌های مختلف نمایش داده شود. علاوه بر این، آدرس برای مدیریت داخلی یکنواخت، نرمال‌سازی شده (فرم NFC) و حروف آن یکسان‌سازی (Case-folded) می‌شوند.

پروفایل PRECIS OpaqueString برای رمزهای عبور اجبار می‌شود. در اینجا قوانین سخت‌گیرانه کمتری اعمال می‌شود. دنباله‌ای از کاراکترهای فضای خالی یونیکد با یک فاصله ASCII جایگزین می‌شوند. سپس نرمال‌سازی NFC اعمال می‌گردد. اگر رشته حاصل خالی باشد، رمز عبور پذیرفته نمی‌شود.

هر دو پروفایل در RFC 8265 تعریف شده‌اند، برای جزئیات به آن مراجعه کنید.

## پشتیبانی از پروتکل‌ها

### افزونه SMTPUTF8

پیاده‌سازی SMTP در maddy شامل پشتیبانی از افزونه SMTPUTF8 طبق تعریف در RFC 6531 است.

این بدان معناست که maddy می‌تواند نام‌های صندوق پستی و نام دامنه‌های بین‌المللی شده را در دستورات MAIL FROM و RCPT TO برای تحویل‌های ورودی و خروجی مدیریت کند.

maddy پیام‌هایی با آدرس‌های پاکت‌نامه غیر ASCII را نمی‌پذیرد مگر اینکه پشتیبانی SMTPUTF8 درخواست شده باشد. اگر پیامی با پرچم SMTPUTF8 تنظیم شده به سروری بدون پشتیبانی SMTPUTF8 فوروارد شود، تحویل پیام با شکست مواجه می‌شود مگر اینکه امکان نمایش آدرس‌های پاکت‌نامه به فرم ASCII وجود داشته باشد (فقط دامنه‌ها از یونیکد استفاده کنند و بتوان آن‌ها را به Punycode تبدیل کرد). محتویات بدنه پیام (و هدر) در نظر گرفته نمی‌شوند و همیشه همان‌طور که هستند پذیرفته و ارسال می‌شوند؛ هیچ کاهش سطح خودکار یا تغییر کدگذاری انجام نمی‌شود.

### افزونه‌های IMAP UTF8 و I18NLEVEL

در حال حاضر، maddy شامل پشتیبانی از افزونه‌های UTF8 و I18NLEVEL در IMAP نمی‌شود. با این حال، این مشکلی نیست که مانع از مدیریت صحیح پیام‌های UTF-8 (یا حتی پیام‌هایی با سایر کدگذاری‌های غیر ASCII ذکر شده در بالا) شود.

کلاینت‌هایی که می‌خواهند مدیریت صحیح رشته‌های یونیکد را پیاده‌سازی کنند، ممکن است فرض کنند maddy آن‌ها را به‌درستی در دستوراتی مانند SEARCH مدیریت نمی‌کند، بنابراین چنین کلاینت‌هایی می‌توانند پیام‌ها را دانلود کرده و آن‌ها را به‌صورت محلی پردازش کنند.
