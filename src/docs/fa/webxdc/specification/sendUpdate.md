---
title: sendUpdate
description: مستندات sendUpdate برای webxdc.
category: مشخصات
---

# sendUpdate

```js
window.webxdc.sendUpdate(update, descr);
```

یک به‌روزرسانی به تمام همتاها ارسال کنید.

تمام همتاها، از جمله فرستنده،
به‌روزرسانی را توسط callback داده شده به [`setUpdateListener()`](./setUpdateListener.html) دریافت خواهند کرد.

شرایطی وجود دارد که کاربر نمی‌تواند پیام به چت ارسال کند،
مثلاً اگر نمونه webxdc به عنوان درخواست تماس بیاید یا اگر کاربر گروه را ترک کرده باشد.
در این موارد، برنامه همچنان می‌تواند `sendUpdate()` را فراخوانی کند،
اما به‌روزرسانی به همتاهای دیگر ارسال نخواهد شد
و به [`setUpdateListener()`](./setUpdateListener.html) هم داده نخواهد شد.

آبجکت `update` دارای خصوصیات زیر است:

- `update.payload`: رشته، عدد، بولین، آرایه، آبجکت یا `null`.
  **نباید** `undefined` باشد.
  هر چیزی که قابل سریال‌سازی JSON نباشد نادیده گرفته خواهد شد،
  این به‌ویژه شامل بافرهای داده باینری مانند `File`، `Blob`، `Int*Array` و غیره می‌شود؛
  در صورت نیاز از مثلاً base64 استفاده کنید.

- `update.info`: اختیاری، پیام اطلاعاتی کوتاه که به چت اضافه خواهد شد،
  مثلاً «آلیس رأی داد» یا «باب ۱۲۳ امتیاز در MyGame گرفت».
  خط‌شکن اضافه نکنید؛ پیاده‌سازی‌ها متن را در حدود ۵۰ کاراکتر یا کمتر قطع می‌کنند.
  اگر سری‌ای از پیام‌های اطلاعاتی وجود داشته باشد، قدیمی‌ترها ممکن است حذف شوند.
  از این گزینه کم استفاده کنید تا چت را شلوغ نکنید.

- `update.href`: رشته اختیاری که یک URL نسبی مشخص می‌کند
  (مثلاً `index.html#about`).
  وقتی یک گیرنده برنامه webxdc را بر اساس آبجکت به‌روزرسانی شروع می‌کند
  برنامه به مکان `href` با URL ریشه برنامه الحاق شده هدایت خواهد شد.

- `update.document`: اختیاری، نام سند در حال ویرایش
  (مثلاً عنوان نظرسنجی یا نام متن در ویرایشگر).
  پیاده‌سازی‌ها نام سند را مثلاً کنار آیکون برنامه یا در نوار عنوان نشان می‌دهند.
  اگر webxdc سندی ایجاد نمی‌کند، مثلاً در بازی‌ها، **نباید** استفاده شود.
  خط‌شکن اضافه نکنید؛ پیاده‌سازی‌ها متن را در حدود ۲۰ کاراکتر یا کمتر قطع می‌کنند.

- `update.summary`: اختیاری، متن کوتاه، نمایش داده شده کنار آیکون برنامه؛
  توصیه می‌شود از مقداری تجمیعی استفاده شود، مثلاً «۸ رأی» یا «بالاترین امتیاز: ۱۲۳».
  خط‌شکن اضافه نکنید؛ پیاده‌سازی‌ها متن را
  در حدود ۲۰ کاراکتر یا کمتر قطع می‌کنند.

- `update.notify`: دیکشنری اختیاری که یک [آدرس](./selfAddr_and_selfName) را
  به متنی نگاشت می‌کند که باید به عنوان اعلان قابل مشاهده به کاربر مخاطب نشان داده شود.
  کلید خاص اختیاری «\*» به عنوان آدرس عمومی عمل می‌کند
  که متن آن در صورتی اعلان می‌شود که `selfAddr` در دیکشنری نباشد.


آرگومان `descr` منسوخ شده اما برای سازگاری به عقب
برنامه‌ها باید یک رشته خالی ارسال کنند.


## استفاده از `info` و `href` برای ناوبری

اگر کاربری روی پیام `info` کلیک کند که `href` مشخص شده دارد
آنگاه برنامه webxdc شروع شده و به مکان مشخص شده هدایت خواهد شد.

برای مثال، یک برنامه تقویم می‌تواند به‌روزرسانی‌ای برای افزودن رویداد تقویم جدید ارسال کند.
اطلاعات در چت نمایش داده خواهد شد و اگر کاربر روی آن ضربه بزند یا کلیک کند
برنامه شروع می‌شود (اگر قبلاً در حال اجرا نباشد) و به
href جدید هدایت می‌شود که مثلاً می‌تواند مستقیماً روز را نشان دهد و رویداد اضافه شده را هایلایت کند.


## محدودیت‌های لایه پیام‌رسانی برای sendUpdate

یک لایه پیام‌رسانی **باید** محدودیت‌های زیر را به برنامه‌های وب نمایش دهد:

- `webxdc.sendUpdateInterval` تعداد میلی‌ثانیه‌هایی را نشان می‌دهد
  که باید قبل از فراخوانی مجدد `sendUpdate()` از آخرین فراخوانی صبر کرد.
  اگر برنامه webxdc زودتر از بازه مشخص شده `sendUpdate` را فراخوانی کند
  لایه پیام‌رسانی ممکن است به‌روزرسانی‌ها را بسیار بیشتر از
  بازه تأخیر دهد.

- `webxdc.sendUpdateMaxSize` حداکثر تعداد بایت‌هایی است که
  لایه پیام‌رسانی برای آبجکت `update` سریال‌سازی شده
  در فراخوانی `sendUpdate` قبول خواهد کرد.

اگر لایه پیام‌رسانی این محدودیت‌ها را نمایش ندهد
برنامه‌های webxdc باید پیش‌فرض‌های زیر را فرض کنند:

- `sendUpdateInterval = 10000`

- `sendUpdateMaxSize = 128000`

### مثال‌ها برای استفاده از محدودیت‌های sendUpdate

اگر از محدودیت‌های پیش‌فرض استفاده شود،
یک برنامه ویرایشگر webxdc می‌تواند تغییرات ترکیبی را در یک فراخوانی `sendUpdate`
حداکثر هر ۱۰ ثانیه ارسال کند
تا لایه پیام‌رسانی تلاش کند هر به‌روزرسانی را بلافاصله ارسال کند.
اگر برنامه ویرایشگر هر ۲ ثانیه `sendUpdate` را فراخوانی کند،
به‌روزرسانی‌ها ممکن است برای مدت طولانی‌تری از `sendUpdateInterval` در صف قرار گیرند.

علاوه بر این، یک ویرایشگر می‌تواند `sendUpdateMaxSize` را نیز بررسی کند
و به‌روزرسانی‌های بزرگتر از حد مجاز را در قطعات کوچکتر ارسال
و در سمت گیرنده دوباره ترکیب کند.
