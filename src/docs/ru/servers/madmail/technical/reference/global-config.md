---
title: Глобальная конфигурация
category: Справочник
---

# Глобальные директивы конфигурации

Эти директивы могут быть указаны вне каких-либо блоков конфигурации и применяются ко всем модулям.

Некоторые директивы могут быть переопределены для конкретных модулей (например, `hostname`).

### state_dir _путь_
По умолчанию: `/var/lib/maddy`

Путь к директории состояния. Эта директория будет использоваться для хранения всех постоянных данных и должна быть доступна для записи.

---

### runtime_dir _путь_
По умолчанию: `/run/maddy`

Путь к директории рантайма. Используется для Unix-сокетов и других временных объектов. Должна быть доступна для записи.

---

### hostname _домен_
По умолчанию: не указано

Интернет-имя хоста (hostname) этого почтового сервера. Обычно используется FQDN. Рекомендуется убедиться, что указанный здесь домен разрешается в публичный IP-адрес сервера.

---

### auth_map _ссылка-на-модуль_
По умолчанию: `identity`

Использовать указанную таблицу для преобразования имен пользователей SASL перед их передачей провайдеру аутентификации.

Перед поиском имени пользователя оно нормализуется с помощью функции, определенной в `auth_map_normalize`.

Обратите внимание, что `auth_map` не влияет на имя используемого аккаунта хранилища. Вероятно, вам также следует использовать `storage_map` в блоке конфигурации IMAP для обработки этого.

Эта директива полезна, если используемый провайдер аутентификации не поддерживает использование адресов электронной почты в качестве имен пользователей, но вы хотите, чтобы у пользователей были отдельные ящики на разных доменах. В этом случае используйте её с таблицей `email_localpart`:

```
    auth_map email_localpart
```

С такой конфигурацией пользователи `user@example.org` и `user@example.com` при аутентификации будут использовать учетные данные `user`, но получат доступ к почтовым ящикам `user@example.org` и `user@example.com` соответственно. Если вы хотите также принимать `user` просто как имя пользователя, используйте `auth_map email_localpart_optional`.

Если вы хотите, чтобы `user@example.org` и `user@example.com` имели один и тот же почтовый ящик, также установите `storage_map` в блоке конфигурации IMAP на использование `email_localpart` (или `email_localpart_optional`, если хотите также принимать просто "user"):

```
    storage_map email_localpart
```

В этом случае вам нужно будет создавать аккаунты хранилища без доменной части в имени:

```
maddy imap-acct create user # вместо user@example.org
```

---

### auth_map_normalize _функция_
По умолчанию: `auto`

Функция нормализации, применяемая к именам пользователей SASL перед их сопоставлением с аккаунтами хранилища.

Доступные варианты:

- `auto` — `precis_casefold_email` для валидных адресов почты, иначе `precis_casefold`.
- `precis_casefold_email` — профиль PRECIS UsernameCaseMapped + форма U-labels для домена.
- `precis_casefold` — профиль PRECIS UsernameCaseMapped для всей строки.
- `precis_email` — профиль PRECIS UsernameCasePreserved + форма U-labels для домена.
- `precis` — профиль PRECIS UsernameCasePreserved для всей строки.
- `casefold` — преобразование в нижний регистр.
- `noop` — ничего не делать.

---

### autogenerated_msg_domain _домен_
По умолчанию: не указано

Домен, который используется в поле `From` для автоматически сгенерированных сообщений (таких как уведомления о статусе доставки — DSN).

---

### tls `file` _файл-сертификата_ _файл-ключа_ | _ссылка-на-модуль_ | `off`
По умолчанию: не указано

Сертификат TLS по умолчанию для всех эндпоинтов.

Должен присутствовать либо в блоках конфигурации всех модулей эндпоинтов, либо в виде глобальной директивы.

Вы также можете указать другие параметры конфигурации, такие как наборы шифров и версии TLS. Подробности см. в maddy-tls(5). Madmail по умолчанию использует разумные наборы шифров и версии TLS, поэтому обычно вам не нужно об этом беспокоиться.

---

### tls_client
По умолчанию: не указано

Это необязательный блок, который задает различные параметры TLS для использования при установке исходящих соединений. См. раздел конфигурации клиента TLS для получения подробной информации о директивах, которые можно в нем использовать. Madmail использует разумные значения по умолчанию.

---

### log _цели..._ | `off`
По умолчанию: `stderr`

Записывать лог в одну или несколько «целей».

Целью может быть одно из следующих значений:

- `stderr` — писать логи в stderr.
- `stderr_ts` — писать логи в stderr с временными метками.
- `syslog` — отправлять логи локальному демону syslog.
- _путь к файлу_ — записывать (дописывать) логи в файл.

Пример:

```
log syslog /var/log/maddy.log
```

**Примечание:** Madmail не выполняет ротацию лог-файлов, это задача демона logrotate. Отправьте сигнал SIGUSR1 процессу Madmail, чтобы он переоткрыл файлы логов.

---

### debug _boolean_
По умолчанию: `no`

Включить подробное логирование для всех модулей. Вам это не нужно, если только вы не сообщаете об ошибке.
