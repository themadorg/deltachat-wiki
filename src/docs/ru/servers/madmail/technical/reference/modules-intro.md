---
title: Введение в модули
category: Справочник
---

# Введение в модули

Madmail построен из множества небольших компонентов, называемых «модулями». Каждый модуль выполняет одну определенную, четко поставленную задачу. Модули можно соединять друг с другом произвольным образом для достижения нужной функциональности. Конфигурационный файл по умолчанию определяет набор модулей, которые вместе реализуют типичный стек почтового сервера.

Чтобы указать модуль, который должен использоваться другим модулем для какой-либо задачи, найдите в конфигурации директивы с аргументом «ссылка на модуль» (module reference). Затем укажите имя модуля в качестве аргумента. При необходимости, если вызываемому модулю это требуется, добавьте дополнительные аргументы после имени. Вы также можете добавить блок конфигурации с дополнительными директивами для настройки модуля.

Вот несколько примеров:

```
smtp ... {
    # Доставлять сообщения модулю 'dummy' с конфигурацией по умолчанию.
    deliver_to dummy

    # Доставлять сообщения модулю 'target.smtp' с 
    # аргументом 'tcp://127.0.0.1:1125' в качестве конфигурации.
    deliver_to smtp tcp://127.0.0.1:1125

    # Доставлять сообщения модулю 'queue' с указанной конфигурацией.
    deliver_to queue {
        target ...
        max_tries 10
    }
}
```

Кроме того, конфигурацию модуля можно вынести в отдельный именованный блок на верхнем уровне и ссылаться на него по имени там, где это необходимо.

Пример:
```
storage.imapsql local_mailboxes {
    driver sqlite3
    dsn all.db
}

smtp ... {
    deliver_to &local_mailboxes
}
```

Рекомендуется использовать этот синтаксис для модулей, инициализация которых ресурсозатратна, таких как бэкенды хранилищ и провайдеры аутентификации.

Синтаксис для определения блока конфигурации на верхнем уровне выглядит следующим образом:
```
пространство_имен.имя_модуля имя_блока_конфигурации... {
    конфигурация_модуля
}
```
Если `имя_блока_конфигурации` опущено, оно будет таким же, как `имя_модуля`. Можно указать несколько имен. Все имена должны быть уникальными.

Обратите внимание на префикс `storage.`. Это фактическое имя модуля, включающее «пространство имен». Это небольшая хитрость для сокращения имен, и префикс можно опускать при ссылке на модуль там, где он используется, так как пространство имен может подразумеваться (например, использование ссылки в `check{}` скорее всего означает, что вы имеете в виду модуль с префиксом `check.`).

Обычные аргументы модуля нельзя указывать при использовании этого синтаксиса, однако модули обычно предоставляют явные директивы для задания необходимых значений. Например, `sql sqlite3 all.db` эквивалентно:
```
storage.imapsql {
    driver sqlite3
    dsn all.db
}
```
