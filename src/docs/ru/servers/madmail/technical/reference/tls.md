---
title: Конфигурация TLS
category: Справочник
---

# Конфигурация TLS

## Сторона сервера

Сертификаты TLS получаются модулями, которые называются загрузчиками сертификатов («certificate loaders»). Аргументы директивы `tls` определяют имя используемого загрузчика и его аргументы.

```
tls file cert.pem key.pem {
    protocols tls1.2 tls1.3
    curves X25519
    ciphers ...
}

tls {
    loader file cert.pem key.pem {
        # Здесь указываются опции для загрузчика.
    }
    protocols tls1.2 tls1.3
    curves X25519
    ciphers ...
}
```

### Доступные загрузчики сертификатов

- `file` — принимает пары аргументов, указывая сначала сертификат, а затем ключ. Например: `tls file certA.pem keyA.pem certB.pem keyB.pem`. Если указано несколько сертификатов, будет использоваться SNI.
- `acme` — автоматически получает сертификат по протоколу ACME (например, Let's Encrypt).
- `off` — явно отключает TLS для указанных эндпоинтов.

## Расширенная конфигурация TLS

**Примечание:** Madmail использует безопасные настройки по умолчанию, а процесс рукопожатия TLS устойчив к атакам на понижение версии. В большинстве случаев ничего менять не нужно.

### `protocols [min-version] [max-version]`
По умолчанию: `tls1.0 tls1.3`

Минимальная/максимальная допустимая версия TLS. Если указано только одно значение, оно будет единственной используемой версией. Допустимые значения: `tls1.0`, `tls1.1`, `tls1.2`, `tls1.3`.

### `ciphers [ciphers...]`
По умолчанию: набор безопасных шифров, определенных в Go.

Список поддерживаемых наборов шифров в порядке предпочтения. Не используется с TLS 1.3.

### `curves [curves...]`
По умолчанию: кривые, определенные в Go.

Эллиптические кривые, используемые при рукопожатии ECDHE. Допустимые значения: `p256`, `p384`, `p521`, `X25519`.

## Конфигурация клиента

Директива `tls_client` позволяет настраивать поведение клиента TLS для исходящих соединений.

```
tls_client {
    protocols tls1.2 tls1.3
    ciphers ...
    curves X25519
    root_ca /etc/ssl/cert.pem

    cert /etc/ssl/private/madmail-client.pem
    key /etc/ssl/private/madmail-client.pem
}
```

### `protocols [min-version] [max-version]`
По умолчанию: `tls1.0 tls1.3`

### `root_ca [paths...]`
По умолчанию: системное хранилище CA.

Список файлов с сертификатами CA в формате PEM, которые будут использоваться при проверке сертификатов серверов.

### `cert [path]` и `key [path]`
По умолчанию: не указано.

Предъявляет указанный сертификат, когда сервер запрашивает сертификат клиента.
