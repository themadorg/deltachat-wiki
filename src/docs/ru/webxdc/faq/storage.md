---
title: Вопросы о хранении состояния приложения
description: Вопросы и ответы о хранении состояния и данных в приложениях webxdc.
category: FAQ
---

# Вопросы о хранении состояния приложения

## Можно ли использовать localStorage или IndexedDB в приложении webxdc?

Да, вы можете использовать и [localStorage](https://developer.mozilla.org/ru/docs/Web/API/Window/localStorage), и [IndexedDB](https://developer.mozilla.org/ru/docs/Web/API/IndexedDB_API) в своем приложении. Однако помните о некоторых ограничениях, [особенно во время симуляции/разработки приложения](#simdb).

У LocalStorage есть [лимит в 4–10 МБ](https://stackoverflow.com/questions/2989284/what-is-the-max-size-of-localstorage-values/), который можно быстро исчерпать, если не соблюдать осторожность. IndexedDB — это альтернатива, не имеющая такого жесткого ограничения по размеру.

Обратите внимание, что браузеры могут очищать данные как в localStorage, так и в IndexedDB, если приложение webxdc долго не использовалось. Если вы хотите надежно сохранить данные, вы должны [отправить обновление приложения](../specification/sendUpdate.html), которое будет надежно сохранено мессенджером. Это также позволит использовать приложение на нескольких устройствах.

## Почему localStorage/IndexedDB не работают с некоторыми симуляторами разработки? {simdb}

Когда вы запускаете приложение в [симуляторе hello](https://github.com/webxdc/hello), все вкладки браузера используют один и тот же экземпляр localStorage или IndexedDB. В реальности мессенджеры запускают каждый экземпляр приложения изолированно. 

Однако [симулятор webxdc-dev](https://github.com/webxdc/webxdc-dev) умеет разделять хранилища для каждого экземпляра приложения, так как каждое запущенное приложение использует отдельный порт localhost для подключения к серверу симулятора.

## Гарантируется ли доставка обновлений приложения участникам чата?

Нет, гарантированной доставки сообщений не существует, как и обратной связи о статусе доставки. Используется подход «наилучших усилий» (best effort). Мессенджеры обычно ставят сообщения в очередь и предпринимают несколько попыток доставки.

Приложения должны учитывать, что порядок обновлений может измениться, а некоторые обновления могут быть потеряны.

Для небольших документов, таких как список покупок, уместно отправлять все состояние документа в качестве обновления при каждом изменении и объединять (merge) входящие данные при получении. Таким образом, изменения могут быть потеряны только в том случае, если отправителю не удастся доставить обновление никому из участников чата и он прекратит использование приложения.

Для документов, состоящих из независимых частей (например, электронная таблица с ячейками), аналогичный подход можно применять независимо к каждой части.

Для некоторых приложений, например игр с таблицей рекордов, отправка новых рекордов отдельными обновлениями вполне допустима, так как потеря одного обновления не критична.

Если у вас сложные документы и вам нужно оптимизировать размер обновлений, передавая только разницу (diff) между состояниями, вам придется реализовать протокол синхронизации самостоятельно. Как и во всех темах сетевой синхронизации, здесь существуют определенные теоретические пределы. В частности, полезно изучить тему [Задачи двух генералов](https://ru.wikipedia.org/wiki/Задача_двух_генералов) и ознакомиться с существующими протоколами обеспечения надежной доставки, прежде чем пытаться реализовать свой собственный.
