---
title: joinRealtimeChannel (экспериментально)
description: Документация функции joinRealtimeChannel (эксперементально) для webxdc.
category: Спецификация
---

# joinRealtimeChannel (экспериментально)

```js
const realtimeChannel = window.webxdc.joinRealtimeChannel();
```

Настраивает и возвращает канал реального времени для данного приложения. Канал предоставляет методы для прослушивания и отправки данных, а также для выхода из канала. Каналы реального времени для каждого приложения являются:

-   **Приватными**: никто вне данного чата не может участвовать в канале реального времени.
-   **Изолированными**: приложения не могут участвовать в каналах других приложений.
-   **Эфемерными**: любые отправленные данные будут получены только теми участниками, которые подключены в данный момент. Участники, подключившиеся позже, их не увидят.

Повторный вызов `joinRealtimeChannel` без выхода из предыдущего канала вызовет ошибку.

## Проверка доступности API

Этот API является экспериментальным и может быть реализован не во всех мессенджерах. Проверить его наличие можно условием: `window.webxdc.joinRealtimeChannel !== undefined`.
(В Delta Chat этот API доступен и включен по умолчанию начиная с версии 1.48).

## `realtimeChannel.setListener((data) => {})`

Начинает прослушивание канала. Переданная функция (callback) будет получать данные в формате `Uint8Array`, отправленные подключенными участниками. Повторный вызов `setListener` заменит предыдущий обработчик.

## `realtimeChannel.send(data)`

Отправляет данные в формате `Uint8Array` подключенным участникам. Размер массива не должен превышать 128 000 байт.

Нет никаких гарантий, что данные будут получены кем-либо, так как в данный момент может не быть подключенных слушателей или могут возникнуть проблемы с сетевым соединением. Приложение само должно определять статус соединения с другими участниками, отслеживая контрольные сообщения.

## `realtimeChannel.leave()`

Выход из канала реального времени. После этого объект `realtimeChannel` становится недействительным и больше не может использоваться. Для повторного входа нужно снова вызвать `window.webxdc.joinRealtimeChannel()`.

## Пример

```js
const realtimeChannel = window.webxdc.joinRealtimeChannel();
realtimeChannel.setListener((data) => {
    console.log("Получены данные реального времени: ", data);
    const msg = new TextDecoder().decode(data);
    console.log("Декодированное сообщение: ", msg);
})

let numMsgs = 0
const refreshIntervalId = setInterval(() => {
    const myId = window.webxdc.selfAddr;
    const data = new TextEncoder().encode(`[${numMsgs}] привет от ${myId}`);
    numMsgs += 1
    console.log("Отправка сообщения", data);
    realtimeChannel.send(data);
    if (numMsgs >= 100) {
        realtimeChannel.leave();
        clearInterval(refreshIntervalId);
    }
}, 1000)
```
