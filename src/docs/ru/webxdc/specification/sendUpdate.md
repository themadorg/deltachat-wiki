---
title: sendUpdate
description: Документация функции sendUpdate для webxdc.
category: Спецификация
---

# sendUpdate

```js
window.webxdc.sendUpdate(update, descr);
```

Отправляет обновление всем участникам.

Все участники, включая отправителя, получат это обновление через функцию обратного вызова, переданную в [`setUpdateListener()`](./setUpdateListener.html).

Существуют ситуации, когда пользователь не может отправлять сообщения в чат (например, если экземпляр webxdc пришел как запрос контакта или если пользователь покинул группу). В этих случаях приложение всё равно может вызвать `sendUpdate()`, но обновление не будет отправлено другим участникам и не попадет в [`setUpdateListener()`](./setUpdateListener.html).

Объект `update` имеет следующие свойства:

-   `update.payload`: строка, число, булево значение, массив, объект или `null`. **НЕ ДОЛЖНО** быть `undefined`. Всё, что не подлежит сериализации в JSON, будет пропущено. Это особенно касается бинарных данных (буферы, `File`, `Blob`, `Int*Array` и т.д.); при необходимости используйте, например, Base64.
-   `update.info`: опциональное короткое информационное сообщение, которое будет добавлено в чат. Например: «Алиса проголосовала» или «Боб набрал 123 очка в Игре». Не используйте переносы строк; реализации обрезают текст примерно на 50 символах или меньше. При серии сообщений старые могут отбрасываться. Используйте экономно, чтобы не спамить в чате.
-   `update.href`: опциональная строка, указывающая на относительный URL (например, `index.html#about`). Когда получатель запускает приложение на основе этого объекта обновления, приложение перейдет по указанному адресу (относительно корня приложения).
-   `update.document`: опциональное название документа (например, заголовок опроса или имя файла в редакторе). Реализации показывают его, например, рядом с иконкой приложения или в заголовке окна. **НЕ ИСПОЛЬЗУЙТЕ**, если приложение не создает документы (например, в играх). Не используйте переносы строк; текст обрезается примерно на 20 символах.
-   `update.summary`: опциональный короткий текст, отображаемый рядом с иконкой. Рекомендуется использовать агрегированные значения, например: «8 голосов», «Рекорд: 123». Не используйте переносы строк; текст обрезается примерно на 20 символах.
-   `update.notify`: опциональный словарь, сопоставляющий [адрес](./selfAddr_and_selfName) пользователя с текстом уведомления, которое должно быть показано этому пользователю. Специальный ключ `"*"` служит шаблоном для всех адресов, не указанных в словаре (сообщение будет показано, если `selfAddr` пользователя не найден в списке).

Аргумент `descr` является устаревшим, но для обратной совместимости приложениям следует передавать пустую строку.

## Использование `info` и `href` для навигации

Если пользователь нажимает на сообщение `info`, в котором указан `href`, приложение webxdc запустится и перейдет по указанному адресу.

Например, приложение-календарь может отправить обновление о новом событии. Краткая информация отобразится в чате, и если пользователь нажмет на неё, приложение откроется (если еще не открыто) и перейдет к новому адресу `href`, который может сразу показать нужный день и выделить событие.

## Лимиты уровня обмена сообщениями для sendUpdate

Уровень обмена сообщениями ДОЛЖЕН предоставлять веб-приложениям информацию о следующих лимитах:

-   `webxdc.sendUpdateInterval`: количество миллисекунд, которое нужно подождать перед следующим вызовом `sendUpdate()`. Если приложение вызывает функцию чаще, уровень обмена сообщениями может задержать доставку обновлений на время, значительно превышающее интервал.
-   `webxdc.sendUpdateMaxSize`: максимальный размер (в байтах), который уровень обмена сообщениями примет для сериализованного объекта `update`.

Если уровень обмена сообщениями не сообщает эти лимиты, приложения должны использовать следующие значения по умолчанию:

-   `sendUpdateInterval = 10000`
-   `sendUpdateMaxSize = 128000`

### Примеры использования лимитов sendUpdate

При использовании стандартных лимитов приложение-редактор может отправлять накопленные изменения одним вызовом не чаще чем раз в 10 секунд, чтобы уровень сообщений пытался отправить каждое обновление немедленно. Если вызывать функцию каждые 2 секунды, обновления могут накапливаться в очереди дольше, чем длится сам `sendUpdateInterval`.

Кроме того, редактор может проверять `sendUpdateMaxSize` и разделять слишком большие обновления на части, объединяя их на стороне получателя.
