---
title: setUpdateListener
description: Документация функции setUpdateListener для webxdc.
category: Спецификация
---

# setUpdateListener

```js
let promise = window.webxdc.setUpdateListener((update) => {}, serial);
```

Функция `setUpdateListener()` определяет обработчик (callback), который получает обновления, отправленные через [`sendUpdate()`]. Обработчик вызывается для обновлений, отправленных вами или другими участниками.

Параметр `serial` указывает номер последнего известного вам обновления (по умолчанию 0).

Возвращаемый промис разрешается (resolves), когда обработчик обработал все сообщения обновлений, известные на момент вызова `setUpdateListener`.

## Объект обновления приложения

Каждое обновление `update`, передаваемое в обработчик, имеет следующие свойства:

-   `update.payload`: соответствует полезной нагрузке, переданной в [`sendUpdate()`].
-   `update.serial`: порядковый номер обновления. Номера начинаются с 1, более новые обновления имеют бóльшие номера. В номерах могут быть пропуски, и не гарантируется, что следующий номер будет ровно на единицу больше предыдущего.
-   `update.max_serial`: максимальный порядковый номер, известный на данный момент. Если `max_serial` равен `serial`, значит, это последнее доступное обновление (пока не придут новые сообщения из сети).
-   `update.info`: опциональное короткое информационное сообщение (см. [`sendUpdate()`]).
-   `update.href`: ссылка внутри приложения («deep link»), переданная отправителем через [`sendUpdate()`].
-   `update.document`: опциональное название документа, заданное отправителем (см. [`sendUpdate()`]). Реализации отображают его, например, рядом с иконкой приложения или в заголовке. Получателю обычно не нужно дополнительно обрабатывать эту информацию.
-   `update.summary`: опциональный короткий текст, отображаемый рядом с иконкой (см. [`sendUpdate()`]).
-   `update.notify`: опциональный список адресов пользователей, которых отправитель намеревался уведомить.

Многократный вызов `setUpdateListener()` приводит к неопределенному поведению: в текущих реализациях будет работать только последний вызванный обработчик.

[`sendUpdate()`]: ./sendUpdate.html
